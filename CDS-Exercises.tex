%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CL provided template
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[12pt,a4paper,oneside,openright]{report}

% makes subsubsections appear in the toc
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}

% turns references into hyperlinks
\usepackage[pdfborder={0 0 0}, colorlinks=true, urlcolor=cyan]{hyperref}
\newcommand{\URL}[1]{\href{https://#1}{\textcolor{cyan}{\texttt{#1}}}}

\usepackage{tablefootnote}

% adjusts page layout
\usepackage[margin=25mm]{geometry}

% allows inclusion of PDF, PNG and JPG images
\usepackage{graphicx}
\graphicspath{ {figs/} }

\usepackage{verbatim}

% itemize with multiple columns
\usepackage{multicol}

% try to avoid widows and orphans
\raggedbottom
\sloppy
\clubpenalty1000%
\widowpenalty1000%

% adjust line spacing to make more readable
\renewcommand{\baselinestretch}{1.1}

% add colour to TODOs
\usepackage{xcolor}

\renewcommand{\chaptername}{Supervision}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Maths
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{amsmath}        % American Mathematical Society
\usepackage{amssymb}        % Maths symbols
\usepackage{amsthm}         % Theorems
\usepackage{mathpartir}    % Proofs and inference rules

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Floats
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{float}
\usepackage[labelfont=bf,margin=10pt]{caption}
\usepackage{subcaption}
\newcommand{\mycaption}[2]{\caption[#1]{#1 #2}}

\floatstyle{plain}
\restylefloat{figure}
\restylefloat{table}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% Figures
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{tikz}
\usepackage{pgfplots}

\newcommand{\graphWidth}{15cm}

% Shamelessly stolen to draw VBox diagrams
\usepackage{threads}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Tables
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{array}
% control width and vertically align text in table cells
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}p{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}p{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}p{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Listings
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{fancyvrb}

\floatstyle{boxed}
%\floatstyle{ruled}
\newfloat{Listing}{tbp}{lol}[chapter]

\DefineVerbatimEnvironment{JavaCode}{Verbatim}
{fontfamily=courier,baselinestretch=1,gobble=4}

\DefineVerbatimEnvironment{GoCode}{Verbatim}
{fontfamily=courier,baselinestretch=1,gobble=4}

\usepackage{listings}
\usepackage{color}
\usepackage{mathtools}

\definecolor{dkgreen}{rgb}{0,0.4,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{
  language=Java,
  aboveskip=0mm,
  belowskip=0mm,
  showstringspaces=false,
  %columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=left,
  keywordstyle=\bfseries,
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true,
  tabsize=4
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Question formatting
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\question}[2]{\paragraph{#1} #2}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Semantic and convenience macros
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\todo}[1]{\textcolor{red}{TODO: #1}}
\newcommand{\note}[1]{\textcolor{blue}{NOTE: #1}}

\newcommand{\javaLiteral}[1]{\texttt{#1}}
\newcommand{\javaCode}[1]{\texttt{#1}}
\newcommand{\javaClass}[1]{\texttt{#1}}
\newcommand{\javaSlot}[1]{\texttt{#1}}
\newcommand{\javaVariable}[1]{\texttt{#1}}
\newcommand{\javaKeyword}[1]{\texttt{#1}}
\newcommand{\javaMethod}[1]{\texttt{#1}}
\newcommand{\javaException}[1]{\texttt{#1}}
\newcommand{\javaAnnotation}[1]{\texttt{#1}}

\newcommand{\keyTerm}[1]{\textbf{#1}}

\newcommand{\codeemph}[1]{\textbf{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Info about document
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\course}{Concurrent and Distributed Systems}

\title{Concurrent and Distributed Systems\\ Exercise Sheet}
\date{\today}
\author{Mike Cachopo}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Start of document
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Cover page
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pagestyle{empty}

\maketitle

\newpage

\pagestyle{plain} \pagenumbering{roman}

\section*{Submitting work}

Submit your answers to the questions as a single PDF file by email. I
am rarely in Cambridge so I can't accept paper submissions. I strongly
suggest using LaTeX to typeset your answers --- you'll need it next
year for your dissertation, and the sooner you start practicing the
better. I recommend using the Ti\textit{k}Z package to make diagrams,
but hand-drawn and scanned is fine if you are in a rush --- you should
prioritise your learning over making your supervision work look
pretty.

The sooner you submit work the more time I have to mark it and give
you detailed feedback. Aim to submit your work 48 hours before the
corresponding supervision. If for some reason you can't submit work in
advance, please let me know not to wait for it. I am happy to mark
work submitted after a supervision in exceptional circumstances, but
keep in mind that you'll be missing out on most of the benefit of the
supervision.

\section*{Questions}

Each supervision is split into three sections:

\subsection*{Bookwork}

\textbf{Do not include the answers to these questions in your work!}

I will ask you these questions quick-fire style at the start of the
supervision, so make you sure you are ready to answer them. The goals
of these questions are:

\begin{itemize}
\item To make sure you know the key concepts you need to understand
  and remember to do well in the course. We have limited time in
  supervisions to cover everything in detail, but we can use these
  questions to check if there are any large holes in your
  understanding.
\item To give you practice explaining computer systems in a precise
  and concise way. This is a skill you will need to answer Tripos
  questions on a variety of courses, if you ever write academic papers
  on systems research, or if you ever have to discuss system design
  with colleagues in an engineering role.
\end{itemize}

  
\subsection*{Exercises}

After using the bookwork questions to check that you understand all of
the content, you will have some past Tripos questions to do. Please
submit written answers to these according to the instructions above.

I suggest practicing answering these questions as you would under exam
conditions. This will help you learn how to answer questions under
time pressure, and how to effectively use your time to get as many
marks as possible in the exam.

Examiners have to mark 100+ scripts per course in just a few
days. They will only spend a couple of minutes looking at your answer,
so you should make it as easy as possible for them to see that you
know what you're talking about. This means that your answer needs to
not only be correct, but also well structured. Here are some tips on
answering systems Tripos questions:

\begin{itemize}
\item Start by answering each part of the question with a few key
  points. This is a good way to pick up 5-10 marks in only a couple of
  minutes.
\item Go back and develop well-reasoned arguments where the question
  asks you to compare two possible solutions to a problem, or add
  relevant details to a description of a particular system's
  implementation. This should put you in the 10-15 mark range with
  about 10 extra minutes of work.
\item Finally, add detail where you think it is relevant or may show
  deeper understanding. This is a great opportunity to show off some
  \textbf{relevant} further reading you've done, and should put you
  comfortably in the 15-20 mark range.
\end{itemize}

This process takes practice, so expect to need a few attempts before
you get comfortable with it. In an exam, you may well choose to settle
for the 10-15 mark range, or even 5-10, so that you can spend more
time on another question. This kind of game of optimisation may seem
sub-optimal to maximise your learning, but sadly Tripos exams are not
optimal learning tools either, and keeping these strategies in mind
will help you maximise your grades.
  
\subsection*{Extensions}

The extension sections contain references to further reading material,
which you are welcome to read if you have spare time and/or are
particularly interested in the course. This material is not
examinable, but understanding it will give you more perspective on the
contents of the course, and better prepare you for more advanced
systems courses, units of assessment, and eventually a career
involving system design.

I do not expect you to write answers to any questions that may appear
in these sections, but I am happy to discuss them in supervision after
we cover the examinable material. If there are other advanced topics
you would like to discuss, please let me know when you submit your
work so that I can prepare in advance.

\section*{General advice}

As an undergraduate in Cambridge, I often felt overwhelmed by all the
work to be done. If there is one piece of advice I can pass down to
you, is to take care of your physical and mental health first, and
only then worry about your work.

If you're struggling, please do not hesitate to reach out to me, your
DoS and your tutor. It is our job to make sure you get the most out of
your education, and we can often help you if you ask for help.

Lastly, enjoy learning through these questions!

\newpage

% \tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% #Content
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\chapter{Concurrency primitives}
\pagestyle{headings} \pagenumbering{arabic}

\section{Bookwork}

\question{The free lunch is over}{Before trying to solve all the
  problems of concurrent programming, it's important to understand why
  concurrency is desirable in the first place. Read
  \cite{FreeLunchIsOver}. We will discuss in the supervision.}

\question{Lecture 1 concepts}{Define and explain the following:
  \begin{itemize}
  \item Multicore processors;
  \item Processes, threads and the differences between them (you may
    want to mention the memory stacks and heap), as well as how
    context switches work;
  \item Concurrency, and the difference between time sharing a single
    core and true parallelism;
  \item User-level, kernel-level and hybrid thread scheduling, the
    advantages and disadvantages of each as well as your favourite
    language that uses each of them;
  \item ``Mostly correct'' code and why it is a problem;
  \item Critical sections and mutual exclusion;
  \item Race conditions and atomic memory operations.
  \end{itemize}
}

\question{Lecture 2 concepts}{
  \begin{itemize}
  \item In a multicore system, would it be possible to achieve mutual
    exclusion on critical sections by locking (having exclusive access
    to) the memory bus when entering a critical section? You may find
    it useful to refer to the slide titled ``Computer Architecture
    Reference Models''.
  \item What can cause a running process/thread to block?
  \item What are the problems with disabling interrupts to provide
    atomic execution of a critical section? Don't forget the ones that
    do not involve other cores or DMA.
  \item Why do we need special ISA instructions to make an atomic
    read-and-set? Are these instructions strictly necessary to write
    correct concurrent programs? You may want to mention Lamport's
    bakery algorithm in your answer.
  \item How would you explain CAS to someone who just finished Part IA
    of the Computer Science Tripos?
  \item How would you explain LL/SC to someone who just finished Part
    IA of the Computer Science Tripos?
  \item What is the difference between deadlock and livelock?
  \item Be prepared to act out the dining philosophers' problem in the
    supervision and explain where the problem lies. Can you think of a
    simple solution?
  \end{itemize}
}

\question{Lecture 3 concepts}{
  \begin{itemize}
  \item Why is sleeping preferable to spinning?
  \item Describe the implementation of a semaphore and its
    operations. Refer to
    \cite[Chapters~10.4--10.6]{bacon2003operating} for more in-depth
    information than the lecture slides.
  \item What is an IPI? For this course you don't need to know much
    about low-level implementation details, but you should be
    comfortable explaining what they are and how they can be used at a
    high level.
  \item How can a semaphore be used to provide mutual exclusion,
    condition synchronisation and resource allocation? What is the
    starting value of the semaphore and what are the logical meanings
    of the operations in each case?
  \item Explain the producer-consumer problem. What are some
    real-world applications of this problem? How can you solve it with
    semaphores? How would you solve it with locks? You may wish to
    refer to \cite[Chapter~11.3]{bacon2003operating}.
  \end{itemize}
}

\question{Lecture 4 concepts}{
  \begin{itemize}
  \item It is safe for multiple threads to concurrently read a shared
    resource, but writes must have exclusive access. Why?  What can go
    wrong if a read and a write happen concurrently?  What can happen
    if two writes happen concurrently?
  \item Be ready to sketch out and discuss several RW lock
    implementations using semaphores in the supervision, focusing on
    their starvation and fairness properties. This should include the
    implementation in \cite[Chapter~11.5]{bacon2003operating}.
  \item What are the advantages of Conditional Critical Regions, and
    why do we care about them? Why is CCR not a common synchronisation
    mechanism?
  \item Where are monitors used in Java, and how do they work? This is
    covered in the \emph{Further Java} companion course. If you
    haven't gotten there yet have a look at the Java specification.
  \item Why are condition variables a useful complement to monitors?
    What are the similarities and differences with semaphores? How are
    they used in Java?
  \item What are the pros and cons of signal-and-wait and
    signal-and-continue semantics? Which is used in Java? What
    implications does this have on how we \texttt{wait} in Java?
  \item How would you implement a RW lock using a monitor? (Hint:
    adapt the implementation using semaphores in
    \cite[Chapter~11.5]{bacon2003operating}.)
  \item What concurrency primitives do C++ pthreads support?
  \end{itemize}
}


\section{Exercises}

\question{Reading and
  writing}{\href{https://www.cl.cam.ac.uk/teaching/exams/pastpapers/y2010p5q4.pdf}{2010
    Paper 5 Question 4}}

\question{Semaphores and
  monitors}{\href{https://www.cl.cam.ac.uk/teaching/exams/pastpapers/y2000p3q1.pdf}{2000
    Paper 3 Question 1}}

\section{Extensions}

\question{Real-life synchronisation}{Explain to me the solution to
  \cite[Chapter~1,~Exercise~4]{ArtMultiprocessorProgramming}.}

\question{Java concurrency}{Ask me any question about concurrent
  programming in Java that I cannot answer. (You will most likely
  succeed if you try hard enough, but I'm curious to see what you'll
  come up with.) You may find it useful to refer to the
  \href{https://docs.oracle.com/javase/specs/jls/se15/html/jls-17.html}{Java
    specification}.}

\question{Double-checked locking}{Read \cite{DCL}. What is your
  favourite solution to the double-checked locking problem with the
  singleton pattern in Java?}

\question{Progress guarantees}{What does it mean for an application to
  be:
  \begin{itemize}
  \item lock-free;
  \item wait-free;
  \item obstruction-free?
  \end{itemize}
  What does it mean for a particular operation within an application
  to have these properties?  }

\chapter{Transactions}

\section{Bookwork}

\question{Lecture 5 concepts}{
  \begin{itemize}
  \item This is repeated from last supervision, but it's worth making
    sure you remember: What is the difference between deadlock and
    livelock?
  \item What are the requirements for the possibility of deadlock? How
    is each of them shown in the ``Resource allocation graph'' in the
    slides? How would you remove each of the requirements?
  \item If you were writing a concurrent application, how would you
    deal with deadlock? This question is deliberately very open-ended,
    we will discuss in supervision.
  \item One way to prevent hold-and-wait is to request all resources
    simultaneously. Why can this be a hard thing to do?
  \item Again, this is a repeat from last supervision, but now you
    should make sure you can do it: What is a simple solution to the
    dining philosophers problem?
  \item \todo{Banker's algorithm?}
  \item What are some pros and cons of the thread scheduling policies
    on the slides?
  \item Sketch out an example scenario of priority inversion without
    using a reference. How would priority inheritance help here?
  \end{itemize}
}

\question{Lecture 6 concepts}{
  \begin{itemize}
  \item Why are higher-level concurrent programming models useful?
    What higher-level models are there, and what are some examples
    (languages that use them, libraries, applications, etc) of each?
  \item Explain the programming model of active objects. What is it
    similar to? How does it provide mutual exclusion and condition
    synchronisation?
  \item Explain message passing. How does it differ from active
    objects? What is the difference between synchronous and
    asynchronous message passing?
  \item Why are ``composite operations'' important? What are some
    examples of applications that may use them?
  \item Explain the problems shown in the composite operation example
    in the slides.
  \item What are the ACID properties?
  \item What is serialisability? How is it different from a serial
    execution?
  \end{itemize}
}

\question{Lecture 7 concepts}{
  \begin{itemize}
  \item What kinds of operation conflicts are there? What are the
    problems caused by each?
  \item What is the difference between strict isolation and non-strict
    isolation?
  \item What are cascading aborts, and why are they a problem?
  \item How does two-phase locking work? What algorithmic difference
    is there between a version of 2PL that offers non-strict isolation
    and one that offers strict isolation? Can you think of a way to
    avoid the need to know the locks required in advance?
  \item Why might a transaction abort?
  \item What approaches are there to rollback a transaction?
  \item How does timestamp ordering work? What timestamp is given to a
    transaction as it begins? At commit time, what needs to be
    checked? What are its pros and cons compared with 2PL?
  \item What is optimistic concurrency control? You may want to read
    \cite[Chapter~20.6]{bacon2003operating} for this one, because the
    slides are somewhat misleading. What are its advantages and
    disadvantages?
  \item Explain the OCC algorithm used in the slides. What's wrong
    with the ``OCC example (2)'' slide? As in, how is it being overly
    conservative? (Hint: can a write-only transaction conflict with
    any committed transaction?)
  \item In an application with a high degree of contention --- many
    concurrent transactions conflict, forcing each other to abort ---
    what is the best synchronisation mechanism?
  \end{itemize}
}

\question{Lecture 8 concepts}{
  \begin{itemize}
  \item What is a crash? What can cause it? What assumptions does the
    fail-stop model make, and how can they be broken?
  \item Why does ``writing all objects to disk on commit'' not work?
    How is write-ahead logging different?
  \item What is the bare minimum information that entries in a
    write-ahead log must hold? What does that information let us do
    when a crash occurs?
  \item Why is lazy write back desirable? What problems does it
    introduce, and how are they solved with a well placed flush? Does
    batching change the guarantees provided by the log?
  \item What benefits do checkpoints give us? In supervision, draw a
    diagram and explain the algorithm for restarting from a
    checkpoint.
  \item In 60 seconds or less, sell me a transactional system. As in,
    convince me that transactions are a ``good'' model to use to write
    a concurrent application (you have to tell me what ``good'' means
    too!)
  \item What are the pros and cons of lock-free programming? What is
    linearisability? If I asked you to implement a lock-free data
    structure, such as a linked list, what would you reply?
  \item What is transactional memory? Why is it ``promising''? Why is
    it not widely used today?
  \end{itemize}
}


\section{Exercises}

\question{TSO and
  OCC}{\href{https://www.cl.cam.ac.uk/teaching/exams/pastpapers/y2007p4q1.pdf}{2007
    Paper 4 Question 1}}

\question{TSO
  details}{\href{https://www.cl.cam.ac.uk/teaching/exams/pastpapers/y2011p5q7.pdf}{2011
    Paper 5 Question 7}}

\section{Extensions}

\question{Message passing}{If you want to know more about message
  passing models read up on Hoare's Communicating Sequential Processes
  (CSP) or Milner's Communicating Sequential Systems (CCS). If you
  would like a reasonably clean introduction to how CSP can be used in
  a programming language, have a look at
  \href{https://tour.golang.org}{A Tour of Go}, in particular the
  section on channels.}

\question{BASE}{What are the BASE properties? Why would they be more
  desirable than ACID?}

\question{Lock-free programming}{The \emph{Multicore Semantics and
    Programming} Part II Unit of Assessment has a two hour lecture on
  lock-free programming. If you want to know more, it's a good place
  to start.}

\question{Transactional memory}{For a relatively short intro to
  Software Transactional Memory, check out
  \cite[Chapter~18]{ArtMultiprocessorProgramming}. For a deeper
  understanding of why STM is a very powerful tool, read \cite{CMT}.}


\chapter{Distributed systems and ordering}

\section{Bookwork}

\question{Introduction to distributed systems}{Let's talk about
  distributed systems from an informal perspective. Some topics to
  cover:
  \begin{itemize}
  \item Intuitively, what is a distributed system? Why are some
    applications distributed? What are some examples?
    % Refer to slide 6
  \item You will learn a lot about TCP/IP, DNS, HTTP and network
    latency and throughput in the Networks course in Lent term. For
    now, let's just make sure you know the basics needed to understand
    communication between processes.
    % Reliable in-order delivery, naming are the most important here
  \item RPC is a very powerful and widely used framework. It is not
    very relevant at the level of abstraction usually kept in this
    course, but you will likely encounter it in many software
    engineering roles. Let's discuss this briefly. Do you see the
    similarity with active objects, from the concurrent part of the
    course? What are the key differences?
    % Talk about marshalling and Java's serialisable, proto buffers,
    % JSON, and compatibility between languages
  \item Distributed systems are extremely complex, and there are a lot
    of problems to solve in the area. Let's briefly talk about the
    specific problems addressed in this course.
    % Ordering of events (using clocks), ordered broadcast over
    % point-to-point links, consensus, replication for fault
    % tolerance, availability and consistency (briefly 2-phase commit)
  \end{itemize}
}

\question{Models of distributed systems}{Now that you have an
  intuitive feel about distributed systems, let's discuss some ways in
  which we can model them. Some topics to cover:
  \begin{itemize}
  \item How would you describe the two generals problem to your
    Engling friend? This is an application of what general problem in
    distributed systems? Can you think of another application?
    % Both students should attempt this; consensus; the example in the
    % slides is acceptable
  \item What assumption made in the two generals problem is no longer
    true in the Byzantine generals problem? Can you think of a
    real-world application of this problem?
    % Blockchain: processes have an incentive to lie, to make more
    % money; mention crypto as a possible solution
  \item What are the three types of behaviour we have to model in a
    distributed system? What are the most common models of each type,
    and what are their properties? Which can we assume in the
    real-world?
    % Network: reliable, fair-loss, arbitrary/adversary links
    % Node: crash-stop, crash-recovery, byzantine
    % Timing: synchronous, partially synchronous, asynchronous
  \item We will talk more about availability later, when we talk about
    consistency, but feel free to ask any questions you have now.
  \item What are faults and failures? Why is the difference important?
    How do we detect them in practice?
    % Fault is single node/link, failure is system wide; timeouts
  \end{itemize}
}

\question{Time, clocks and ordering}{In the concurrency part of the
  course, we saw that being able to order events is quite a neat
  ability. For example, when we attempt to serialise transactions,
  it's useful to be able to say that one transaction is serialised
  \emph{before} another. As it turns out, ordering is much more
  difficult in a distributed system.
  \begin{itemize}
  \item Read the first two pages of Lamport's paper on time
    \cite{lamport1978time}. Why must orderings in a distributed system
    be only partial orders?
  \item What kinds of physical clocks are there? What is each used
    for? What are the shortcomings of each?
    % Quartz clocks (50ppm), atomic (1E-14), mention GPS
  \item What representations of physical time are there? How is each
    of them useful?
    % UTC is International atomic time (TAI) + corrections for Earth's
    % rotation (leap seconds); Unix time (seconds since epoch); ISO
    % 8601 date+time
  \item What is the purpose of NTP? How does it achieve this goal? In
    words, how does an NTP client estimate clock skew from an NTP
    server? What assumptions are made here? Are they fair assumptions
    to make?
    % Clock synchronisation; Stratum 0 is clock, 1 is server with
    % clock; slew if <125ms, else step if <1000s, else panic
  \item Why might it be useful to order messages in a distributed
    system? Can you think of a real-world example that does not
    involve discourse about cheese?
    % Distributed transaction system; node receives "update object X"
    % before it receives "create object X" from another node.
  \item How is a happens-before relationship on the events in a
    distributed system defined?
    % Local execution, message delivery, transitive closure
  \end{itemize}
}

\question{Broadcast protocols and logical time}{Now that we've seen
  how impractical physical time is in a distributed system, let's
  focus on logical time. A word of advice: whenever you start thinking
  about a logical clock, make sure you know what the clock is
  ordering. Is it ordering messages? Events? Transactions? Forgetting
  to state this explicitly will lead to misunderstandings and bugs
  that are difficult to pin down!
  % Mention this!
  \begin{itemize}
  \item In 60 seconds, explain Lamport clocks. You may want to
    mention:
    \begin{itemize}
    \item What is being ordered?
      % Local events
    \item What are the steps in the algorithm?
      % Increment on event; on receive max then increment
      % Mention similarity with the rules for building a hb relation
    \item How do Lamport clocks relate to a causal happens-before
      relationship?
      % a -> b implies L(a) < L(b), but not the opposite
    \item What does it mean for two events to have the same timestamp?
      % Either the same event, or completely unrelated at different
      % nodes
    \item How can a total order be formed from Lamport timestamps?
      % Make timestamps out of (L timestamp, node id)
    \end{itemize}
  \item As above, but now for vector clocks.
  \item In 30 seconds, explain the isomorphism between vector clocks
    and sets of events.
  \item What are the trade-offs between Lamport clocks and vector
    clocks? How does each of them scale with the number of processes
    and the amount of communication? How does each of them handle
    dynamic process groups?
    % Mention size, expressiveness, different types of orders
  \item What are broadcast protocols, and why are they useful?
  \item What is the difference between ``receiving'' and
    ``delivering'' a message? At which layer does each of them happen?
    Why is this distinction useful?
  \item Let's have a free-form discussion about ordering of broadcast
    messages. Please come prepared to explain each of the ordering
    schemes presented in the course, why they might be useful, and how
    they can be implemented.
    % FIFO: reliable link (retransmit + dedup) + pairwise seq number
    % Causal: essentially vector clocks
    % Total order: leader dictates order OR Lamport timestamps but
    % need to wait for a timestamp > T from each node before
    % delivering message with timestamp T
    % FIFO total order: FIFO + total order
  \item Why is FIFO-total order broadcast strictly stronger than
    causal broadcast?
  \end{itemize}
}

\section{Exercises}

\question{Distributed
  time}{\href{https://www.cl.cam.ac.uk/teaching/exams/pastpapers/y2001p9q1.pdf}{2001
    Paper 9 Question 1}}

\question{Vector
  clocks}{\href{https://www.cl.cam.ac.uk/teaching/exams/pastpapers/y2005p9q4.pdf}{2005
    Paper 9 Question 4}}


\section{Extensions}

\question{GRPC}{If you end up writing parts of a distributed system,
  there's a good chance that you'll have to use GRPC or a similar
  framework. Feel free to do some research on it and discuss in
  supervision.}

\question{Catchup}{In the last supervision we will be covering
  consensus and distributed consistency, which are both very complex
  problems. Now is a good time for you to ask any questions you have
  on the course so far, as we are less likely to have time for them in
  the final supervision.}


\chapter{Topics in distributed systems}

\section{Bookwork}

\question{Lecture 13 concepts}{
  \begin{itemize}
  \item What is a central lock server? What problem does it solve?
    What are its pros and cons? Can you think of a way of implementing
    a time-out that is different from the one in the slides? How does
    it compare?
  \item How does token passing work in a ring? What are its pros and
    cons for implementing distributed locking? How many tokens are
    there? (This last part is ambiguous by design. How could you use
    more than one token?)
  \item How does total-order multicast work? Why do we need a total
    order on all messages? How can you achieve this with a Lamport
    timestamp? What are the consequences of such an approach?
  \item How would you describe the difficulties of distributed
    transactions to someone that just finished the ``concurrency''
    part of this course?
  \item What problem does two-phase commit solve? Why does the
    coordinator default to abort when one of the servers times out?
  \item What is replication? What are passive and active replication?
    What properties does each give a distributed application? What are
    cold-, warm- and hot-standby?
  \item What is RAID? What properties do RAID 0, 1 and 5 give us?
  \item In 60 seconds, explain to your supervisions partner(s) the
    concepts of strong and weak consistency, and tell me something I
    don't know about consistency in a distributed system.
  \end{itemize}
}

\question{Lecture 14 concepts}{
  \begin{itemize}
  \item What is a ``leader'' in a distributed system? Why is a leader
    useful? How would you describe a generic leader election algorithm
    to someone who just finished Part IA of the Computer Science
    Tripos?
  \item Why is ``highest ID'' a commonly used heuristic in leader
    election? How is the process with the highest ID found in a
    ring-based election and in the bully algorithm? (Be ready to draw
    a diagram in the supervision.)
  \item What is a network partition? Can it lead to more complicated
    problems than single-machine failures? Why?
  \item \todo{UPDATE ME!!!}
  \end{itemize}
}

\question{Lecture 15 concepts}{
  \begin{itemize}
  \item What are the pros and cons of the first algorithm to achieve
    consistency shown in the slides? It is a particular instance of
    which algorithm?
  \item What is a ``quorum''? How can a quorum system be used to
    implement strong consistency? Why do we need the constraint that
    the write quorum must be larger then half the number of replicas?
  \item How can we change a quorum system to provide ``weak
    consistency''? What properties are provided by strong consistency
    but not in this case?
  \item What is eventual consistency? How does it compare with strong
    and weak consistency? How can it be implemented? What are write
    conflicts?
  \item What are session guarantees, and what properties can they be
    used to provide? What are their drawbacks, and how can we mitigate
    them?
  \item What is the CAP theorem? How big are its implications to
    real-world distributed systems? (You may want to skim the Spanner
    article in the extensions section.)
  \item What is MapReduce? Why is it such a successful framework?
    (This is deliberately vague, let's discuss in supervision.)
  \item Pick one of the applications case studies in the slides and
    explain it to me. You can assume I know nothing about the
    application in particular, but I do know a fair amount about
    distributed systems. Exercise your ability to talk about computer
    systems, and feel free to include some information not in the
    course. You may want to cover, for example:
    \begin{itemize}
    \item What problem is the application trying to solve?
    \item What components does it have?
    \item What key algorithms --- covered in this course or otherwise
      --- are used?
    \item What interesting properties does the application have?
    \end{itemize}
  \end{itemize}
}

\question{Lecture 16 concepts}{
  \begin{itemize}
  \item What are administrative domains? Why do they make it necessary
    to implement distributed security protocols? What is a trusted
    computing base?
  \item What are identification, authentication and authorisation?
  \item What is an access control matrix? Why don't we use one
    directly? What are ACLs and capabilities? What are the pros and
    cons of each?
  \item What is role-based access control? Describe an example
    application that uses RBAC.
  \item How would you describe single-system sign on to someone who
    just finished Part IA of the Computer Science Tripos?
  \item Pick one of AFS or Coda and explain it to me in 60 seconds or
    less. Use the same rules as for the case study question from
    Lecture 15.
  \end{itemize}
}

\section{Exercises}

% \question{Consistency}{\href{https://www.cl.cam.ac.uk/teaching/exams/pastpapers/y2004p8q4.pdf}{2004
% Paper 8 Question 4}}

\question{Process
  naming}{\href{https://www.cl.cam.ac.uk/teaching/exams/pastpapers/y1998p12q1.pdf}{1998
    Paper 12 Question 1}}

\question{RPC and
  ORB}{\href{https://www.cl.cam.ac.uk/teaching/exams/pastpapers/y1999p9q1.pdf}{1999
    Paper 9 Question 1}}

\question{Access
  control}{\href{https://www.cl.cam.ac.uk/teaching/exams/pastpapers/y2000p8q1.pdf}{2000
    Paper 8 Question 1}}

\section{Extensions}

\todo{Consensus (Paxos and/or Raft), Spanner and the CAP theorem.}

\bibliographystyle{apalike}

\bibliography{biblio}

\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
