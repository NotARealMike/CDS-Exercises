%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CL provided template
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[12pt,a4paper,oneside,openright]{report}

% makes subsubsections appear in the toc
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}

% turns references into hyperlinks
\usepackage[pdfborder={0 0 0}, colorlinks=true, urlcolor=cyan]{hyperref}
\newcommand{\URL}[1]{\href{https://#1}{\textcolor{cyan}{\texttt{#1}}}}

\usepackage{tablefootnote}

% adjusts page layout
\usepackage[margin=25mm]{geometry}

% allows inclusion of PDF, PNG and JPG images
\usepackage{graphicx}
\graphicspath{ {figs/} }

\usepackage{verbatim}

% itemize with multiple columns
\usepackage{multicol}

% try to avoid widows and orphans
\raggedbottom
\sloppy
\clubpenalty1000%
\widowpenalty1000%

% adjust line spacing to make more readable
\renewcommand{\baselinestretch}{1.1}

% add colour to TODOs
\usepackage{xcolor}

\renewcommand{\chaptername}{Supervision}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Maths
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{amsmath}        % American Mathematical Society
\usepackage{amssymb}        % Maths symbols
\usepackage{amsthm}         % Theorems
\usepackage{mathpartir}    % Proofs and inference rules

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Floats
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{float}
\usepackage[labelfont=bf,margin=10pt]{caption}
\usepackage{subcaption}
\newcommand{\mycaption}[2]{\caption[#1]{#1 #2}}

\floatstyle{plain}
\restylefloat{figure}
\restylefloat{table}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
% Figures
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{tikz}
\usepackage{pgfplots}

\newcommand{\graphWidth}{15cm}

% Shamelessly stolen to draw VBox diagrams
\usepackage{threads}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Tables
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{array}
% control width and vertically align text in table cells
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}p{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}p{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}p{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Listings
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{fancyvrb}

\floatstyle{boxed}
%\floatstyle{ruled}
\newfloat{Listing}{tbp}{lol}[chapter]

\DefineVerbatimEnvironment{JavaCode}{Verbatim}
{fontfamily=courier,baselinestretch=1,gobble=4}

\DefineVerbatimEnvironment{GoCode}{Verbatim}
{fontfamily=courier,baselinestretch=1,gobble=4}

\usepackage{listings}
\usepackage{color}
\usepackage{mathtools}

\definecolor{dkgreen}{rgb}{0,0.4,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{
  language=Java,
  aboveskip=0mm,
  belowskip=0mm,
  showstringspaces=false,
  %columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=left,
  keywordstyle=\bfseries,
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true,
  tabsize=4
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Question formatting
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\question}[2]{\paragraph{#1} #2}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Semantic and convenience macros
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\todo}[1]{\textcolor{red}{TODO: #1}}
\newcommand{\note}[1]{\textcolor{blue}{NOTE: #1}}

\newcommand{\javaLiteral}[1]{\texttt{#1}}
\newcommand{\javaCode}[1]{\texttt{#1}}
\newcommand{\javaClass}[1]{\texttt{#1}}
\newcommand{\javaSlot}[1]{\texttt{#1}}
\newcommand{\javaVariable}[1]{\texttt{#1}}
\newcommand{\javaKeyword}[1]{\texttt{#1}}
\newcommand{\javaMethod}[1]{\texttt{#1}}
\newcommand{\javaException}[1]{\texttt{#1}}
\newcommand{\javaAnnotation}[1]{\texttt{#1}}

\newcommand{\keyTerm}[1]{\textbf{#1}}

\newcommand{\codeemph}[1]{\textbf{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Info about document
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\course}{Concurrent and Distributed Systems}

\title{Concurrent and Distributed Systems\\ Exercise Sheet}
\date{\today}
\author{Mike Cachopo}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Start of document
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Cover page
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pagestyle{empty}

\maketitle

\newpage

\pagestyle{plain} \pagenumbering{roman}

\section*{Questions}

Each supervision is split into three sections:

\begin{description}
\item[Bookwork] \hfill\\
  This section focuses on the key concepts you need to understand and
  remember to do well in the course. It's not worth including these
  definitions in your answers, but they should be on the tip of your
  tongue if you're asked about them in a supervision! If there is
  anything here you don't understand please send me an email, so that
  we can address it in advance and you can take the most out of the
  supervision.
\item[Exercises] \hfill\\
  This is where I expect you to spend most of your time and effort. If
  you get stuck on a question, move onto the others and come back to
  it later. If you're still stuck, either send me an email or leave a
  note to discuss during the supervision.
\item[Extensions] \hfill\\
  If you have some spare time or interest after finishing the core
  exercises, have a look at the extensions. They cover topics that are
  just beyond the scope of the course, so attempting these questions
  is optional. However, spending some time here will give you a deeper
  understanding of the course, which will be helpful later.
\end{description}

\section*{Submitting work}

Submit your answers to the questions as a single PDF file \todo{email
  address?}. I am rarely in Cambridge so I can't accept paper
submissions. I strongly suggest using LaTeX to typeset your answers
--- you'll need it next year for your dissertation, and the sooner you
start practicing the better.

The sooner you submit work the more time I have to mark it and give
detailed feedback. Aim to submit your work 48 hours before the
corresponding supervision. If for some reason you can't do that,
please let me know not to wait for it. I am happy to mark work
submitted after a supervision in exceptional circumstances, but keep
in mind that you'll be missing out on most of the benefit of the
supervision.

\section*{General advice}

In Cambridge, it is easy to feel overwhelmed by all the work to be
done, and like your supervisors expect your life to revolve around
work. They don't, and it shouldn't. Take care of your physical and
mental health first, and then your work.

If you're struggling, let your relevant supervisors, DoS and Tutor
know so that they can help. \todo{Maybe include a link to a student
  helpline?}

Lastly, enjoy learning through these questions!

\newpage

\tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% #Content
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\chapter{Concurrency primitives}
\pagestyle{headings} \pagenumbering{arabic}

\section{Bookwork}

\question{The free lunch is over}{Before trying to solve all the
  problems of concurrent programming, it's important to understand why
  concurrent programming is desirable in the first place. Read
  \cite{FreeLunchIsOver}. We will discuss in the supervision.}

\question{Lecture 1 concepts}{Define and explain the following:
  \begin{itemize}
  \item Multicore processors;
  \item Processes, threads and the differences between them (you may
    want to mention the memory stacks and heap), as well as how
    context switches work;
  \item Concurrency, and the difference between time sharing a single
    core and true parallelism;
  \item User-level, kernel-level and hybrid thread scheduling, the
    advantages and disadvantages of each as well as your favourite
    language that uses each of them;
  \item ``Mostly correct'' code and why it is a problem;
  \item Critical sections and mutual exclusion;
  \item Race conditions and atomic memory operations.
  \end{itemize}
}

\question{Lecture 2 concepts}{Answer the following questions:
  \begin{itemize}
  \item In a multicore system, would it be possible to achieve mutual
    exclusion on critical sections by locking (having exclusive access
    to) the memory bus when entering a critical section? You may find
    it useful to refer to the slide titled ``Computer Architecture
    Reference Models''.
  \item What can cause a running process/thread to block?
  \item What are the problems with disabling interrupts to provide
    atomic execution of a critical section? Don't forget the ones that
    do not involve other cores or DMA.
  \item Why do we need special ISA instructions to make an atomic
    read-and-set? Are these instructions strictly necessary to write
    correct concurrent programs? You may want to mention Lamport's
    bakery algorithm in your answer, but don't spend much time trying
    to understand it.
  \item How would you explain CAS to someone who never heard of it?
  \item How would you explain LL/SC to someone who never heard of it?
  \item What is the difference between deadlock and livelock?
  \item Be prepared to act out the dining philosophers' problem in the
    supervision and explain where the problem lies. Can you think of a
    simple solution?
  \end{itemize}
}

\question{Lecture 3 concepts}{Answer the following questions:
  \begin{itemize}
  \item Why is sleeping preferable to spinning?
  \item Describe the implementation of a semaphore and its
    operations. Refer to
    \cite[Chapters~10.4--10.6]{bacon2003operating} for more in-depth
    information than the lecture slides.
  \item What is an IPI? For this course you don't need to know much
    about low-level implementation details, but you should be
    comfortable explaining what they are and how they can be used at a
    high level.
  \item How can a semaphore be used to provide mutual exclusion,
    condition synchronisation and resource allocation? What is the
    starting value of the semaphore and what are the logical meanings
    of the operations in each case?
  \item Explain the producer-consumer problem. What are some
    real-world applications of this problem? How can you solve it with
    semaphores? How would you solve it with locks? You may wish to
    refer to \cite[Chapter~11.3]{bacon2003operating}.
  \end{itemize}
}

\question{Lecture 4 concepts}{Answer the following questions:
  \begin{itemize}
  \item It is safe for multiple threads to concurrently read a shared
    resource, but writes must have exclusive access. Why?  What can go
    wrong if a read and a write happen concurrently?  What can happen
    if two writes happen concurrently?
  \item Be ready to sketch out and discuss several RW lock
    implementations using semaphores in the supervision, focusing on
    their starvation and fairness properties. This should include the
    implementation in \cite[Chapter~11.5]{bacon2003operating}.
  \item What are the advantages of Conditional Critical Regions, and
    why do we care about them? Why is CCR not a common synchronisation
    mechanism?
  \item Where are monitors used in Java, and how do they work? This is
    covered in the \emph{Further Java} companion course. If you
    haven't gotten there yet have a look at the Java specification.
  \item Why are condition variables a useful complement to monitors?
    What are the similarities and differences with semaphores? How are
    they used in Java?
  \item What are the pros and cons of signal-and-wait and
    signal-and-continue semantics? Which is used in Java? What
    implications does this have on how we \texttt{wait} in Java?
  \item How would you implement a RW lock using a monitor? (Hint:
    adapt the implementation using semaphores in
    \cite[Chapter~11.5]{bacon2003operating}.)
  \item What concurrency primitives do C++ phtreads support?
  \end{itemize}
}

\todo{processes, threads, interrupts, locks, semaphores, condition
  synchronisation, lock-free/wait-free, obstruction-free, deadlock,
  livelock, priority inversion, transactions, serialisability and
  linearisability}

\section{Exercises}

\section{Extensions}


\chapter{Transactions}

\section{Bookwork}

\question{Lecture 5 concepts}{Define the following terms:
  \begin{itemize}
  \item This is repeated from last supervision, but it's worth making
    sure you remember: What is the difference between deadlock and
    livelock?
  \item What are the requirements for the possibility of deadlock? How
    is each of them shown in the ``Resource allocation graph'' in the
    slides? How would you remove each of the requirements?
  \item If you were writing a concurrent application, how would you
    deal with deadlock? This question is deliberately very open-ended,
    we will discuss in supervision.
  \item One way to prevent hold-and-wait is to request all resources
    simultaneously. Why can this be a hard thing to do?
  \item Again, this is a repeat from last supervision, but now you
    should make sure you can do it: What is a simple solution to the
    dining philosophers problem?
  \item \todo{Banker's algorithm?}
  \item What are some pros and cons of the thread scheduling policies
    on the slides?
  \item Sketch out an example scenario of priority inversion without
    using a reference. How would priority inheritance help here?
  \end{itemize}
}

\question{Lecture 6 concepts}{Define the following terms:
  \begin{itemize}
  \item Why are higher-level concurrent programming models useful?
    What higher-level models are there, and what are some examples
    (languages that use them, libraries, applications, etc) of each?
  \item Explain the programming model of active objects. What is it
    similar to? How does it provide mutual exclusion and condition
    synchronisation?
  \item Explain message passing. How does it differ from active
    objects? What is the difference between synchronous and
    asynchronous message passing?
  \item Why are ``composite operations'' important? What are some
    examples of applications that may use them?
  \item Explain the problems shown in the composite operation example
    in the slides.
  \item What are the ACID properties?
  \item What is serialisability? How is it different from a serial
    execution?
  \end{itemize}
}

\question{Lecture 7 concepts}{Define the following terms:
  \begin{itemize}
  \item What kinds of operation conflicts are there? What are the
    problems caused by each?
  \item What is the difference between strict isolation and non-strict
    isolation?
  \item What are cascading aborts, and why are they a problem?
  \item How does two-phase locking work? What algorithmic difference
    is there between a version of 2PL that offers non-strict isolation
    and one that offers strict isolation? Can you think of a way to
    avoid the need to know the locks required in advance?
  \item Why might a transaction abort?
  \item What approaches are there to rollback a transaction?
  \item How does timestamp ordering work? What timestamp is given to a
    transaction as it begins? At commit time, what needs to be
    checked? What are its pros and cons compared with 2PL?
  \item What is optimistic concurrency control? You may want to read
    \cite[Chapter~20.6]{bacon2003operating} for this one, because the
    slides are somewhat misleading. What are its advantages and
    disadvantages?
  \item Explain the OCC algorithm used in the slides. What's wrong
    with the ``OCC example (2)'' slide? As in, how is it being overly
    conservative? (Hint: can a write-only transaction conflict with
    any committed transaction?)
  \item In an application with a high degree of contention --- many
    concurrent transactions conflict, forcing each other to abort ---
    what is the best synchronisation mechanism?
  \end{itemize}
}

\question{Lecture 8 concepts}{Define the following terms:
  \begin{itemize}
  \item What is a crash? What can cause it? What assumptions does the
    fail-stop model make, and how can they be broken?
  \item Why does ``writing all objects to disk on commit'' not work?
    How is write-ahead logging different?
  \item What is the bare minimum information that entries in a
    write-ahead log must hold? What does that information let us do
    when a crash occurs?
  \item Why is lazy write back desirable? What problems does it
    introduce, and how are they solved with a well placed flush? Does
    batching change the guarantees provided by the log?
  \item What benefits do checkpoints give us? In supervision, draw a
    diagram and explain the algorithm for restarting from a
    checkpoint.
  \item In 60 seconds or less, sell me a transactional system. As in,
    convince me that transactions are a ``good'' model to use to write
    a concurrent application (you have to tell me what ``good'' means
    too!)
  \item What are the pros and cons of lock-free programming? What is
    linearisability? If I asked you to implement a lock-free data
    structure, such as a linked list, what would you reply?
  \item What is transactional memory? Why is it ``promising''? Why is
    it not widely used today?
  \end{itemize}
}


\section{Exercises}

\section{Extensions}

\question{Message passing}{If you want to know more about message
  passing models read up on Hoare's Communicating Sequential Processes
  (CSP) or Milner's Communicating Sequential Systems (CCS). If you
  would like a reasonably clean introduction to how CSP can be used in
  a programming language, have a look at
  \href{https://tour.golang.org}{A Tour of Go}, in particular the
  section on channels.}

\question{BASE}{What are the BASE properties? Why would they be more
  desirable than ACID?}

\question{Lock-free programming}{The \emph{Multicore Semantics and
    Programming} Part II Unit of Assessment has a two hour lecture on
  lock-free programming. If you want to know more, it's a good place
  to start.}

\question{Transactional memory}{For a relatively short intro to
  Software Transactional Memory, check out
  \cite[Chapter~18]{ArtMultiprocessorProgramming}. For a deeper
  understanding of why STM is a very powerful tool, read \cite{CMT}.}

\todo{lock-free, wait-free, obstruction-free, slide 10 AND-OR wait-for
  graphs}

\chapter{Clocks I think?}

\section{Bookwork}

\question{Lecture 9 concepts}{Define the following terms:
  \begin{itemize}
  \item Stub
  \end{itemize}
}

\section{Exercises}

\section{Extensions}

\chapter{Some more distributed stuff}

\section{Bookwork}

\question{Lecture 13 concepts}{Define the following terms:
  \begin{multicols}{2}
    \begin{itemize}
    \item Stub
    \end{itemize}
  \end{multicols}
}

\section{Exercises}

\section{Extensions}

\bibliographystyle{apalike}

\bibliography{biblio}

\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
